@(dcr: models.mr.DailyCallReport, dcrLineItemForm:play.data.Form[models.mr.DCRLineItem],doctorList: List[models.doctor.Doctor],productList: List[Product])

@import play.i18n._
@import helper.twitterBootstrap._
@import helper._

@main("DCR Line Item"){
        <script type="text/javascript" src="/assets/javascripts/bootstrap.min.js"></script>
        <script src="@routes.Assets.at("javascripts/bootstrap-timepicker.min.js")" type="text/javascript"></script>
	<link href="/assets/css/bootstrap-timepicker.min.css" rel="stylesheet" type="text/css" />
	
	<style>
	.bootstrap-timepicker-widget table td input {
		width: 40px;
		}
	</style>
	<script>
	var proList = '<option value="" disabled selected style="display:none;">Select Sample</option>@for(product <-productList){<option value="@product.id">@product.medicineName</option>}';
	function removeSamples(id){
	$('#sample'+id).remove();
    }	
	
	var i=0;
	function addSamples(){
		$('#samplestbl').append('<tr id="sample'+i+'"><td><select class="chzn" style="width:200px;" name="sampleList">'+proList+'</select></td><td><input name="qtyList" placeholder="qty" /></td><td><a class="btn btn-danger btn-xs" onclick="removeSamples('+i+');">-</a></td></tr>');
	    i++;
	    $('.chzn').chosen();
	}
	
	</script>
	<script>
	
	$('#timepicker1').on('keydown',function(e){ 
	        e.preventDefault();
			});
	</script>
	
	
	<form id="dcrliform">
	<table border="1">
	<thead>
	   <th>Doctors</th>
	   <th>Samples</th>
	   <th>Promotions</th>
	   <th>In Time</th>
	   <th>Out Time</th>
	   <th>POB</th>
	   <th>Remarks</th>
	</thead>
	<tbody>
	<tr>
		
		<td valign="top" >
		<select data-placeholder="Select Doctor" class="chzn" name="doctor" style="width:200px;">
		   <option></option>
			@for(doctor <- doctorList){
	      	<option value=@doctor.id >@doctor.appUser.name</option>
	        }
	       </select>
	    </td>
	    
	    
		<td valign="top">
			<div id="samplesdiv">
			<table id="samplestbl">
				<tr>
					<td>
				  	   	<select data-placeholder="Select Sample" class="chzn" name="sampleList" style="width:200px;">
				  	   	   <option ></option>
				  	   	   <option value="0">None</option>
							@for(product <- productList){
					      	<option value="@product.id">@product.medicineName</option>
					        }
			   		    </select>
					</td>
					<td>
						<input name="qtyList" placeholder="qty"/>
					</td>
					<td>
						&nbsp;
					</td>
				</tr>
			</table>
			</div>   
			<button  type="button" class="btn btn-primary btn-xs" onclick="addSamples();">+</button>
	   	</td>
	   
	   
	   <td valign="top" >
			    <select data-placeholder="Select Promotions" class="chzn" name="promotionList" multiple="true" style="width:200px;">
			    <option></option>
				@for(product <- productList){
				<option value=@product.id >@product.medicineName</option>
				}
				</select>
		</td>
		<td valign="top">
				<div class="input-append bootstrap-timepicker">
	   			<input id="timepicker1" name="inTime" class="input-small" style="padding-left:20px">
	            <span class="add-on"><i class="fa fa-clock-o"></i></span>
	       		</div>
        </td>
		<td valign="top">
			<div class="input-append bootstrap-timepicker">
	   			<input id="timepicker2" name="outTime" class="input-small" padding-left:20px">
	            <span class="add-on"><i class="fa fa-clock-o"></i></span>
	        </div>
        </td>
        
		<td valign="top"  ><input name="pob" /></td>
		<td valign="top" ><input name="remarks" type="text" placeholder="Remarks"/></td>
      </tr>
		
   </tbody>
	</table>
	
	<input type="hidden" name="dcrId" value="@dcr.id">

	</form>
	
<input class="btn btn-primary" onclick="addLineItem();" value="Add" />
	
	<hr>
	
	
	<div id="dcrLineItemTable">

<table class="table table-bordered table-condensed">
	<thead>
	<tr>
	   <th>Doctors</th>
	   <th>Samples (Qty)</th>
	   <th>Promotions</th>
	   <th>InTime</th>
	   <th>OutTime</th>
	   <th>POB</th>
	   <th>Remarks</th>
	   <th>Actions</th>
	</tr>   
	</thead>
	<tbody>
	@for(dcrLineItem <- dcr.dcrLineItemList){
	<tr>
		<td>@dcrLineItem.doctor.appUser.name</td>
		<td>
			@for(sample <- dcrLineItem.sampleList){
				@if(sample.product != null){
				@sample.product.medicineName (@sample.quantity)
				<br>
				}
			}
	   	</td>
	   	<td valign="top">
			<div id="samplesdiv">
			      <table> 	
				  	@for(promotedProduct <- dcrLineItem.promotionList){
					  <tr>
						 <td>@promotedProduct.medicineName</td>
					  </tr>
					 }
			      </table>
			</div>   
	   	</td>
	   	
	   	<td>@dcrLineItem.inTime</td>
	   	
	   	<td>@dcrLineItem.outTime</td>
	   	
	   	
	    @if(dcrLineItem.pob==0){
	   		<td>&nbsp;</td>
	   	}else{
	   	<td>@dcrLineItem.pob</td>
	   	}
	   	
		<td>@dcrLineItem.remarks</td>
		<td><a class="btn btn-danger btn-md" onclick="removeLineItem('@dcrLineItem.id');">Remove</a></td>
     </tr>
     }
   </tbody>
  </table>	
  
	</div>
	
	<script type="text/javascript"> 
            $('#timepicker1').timepicker();
            $('#timepicker2').timepicker();
    </script>
    
	<script>

	    function addLineItem(){
	        $.post('/mr/dcr/add-line-item',$('#dcrliform').serialize(),function(html){
				$('#dcrLineItemTable').html(html);
			});
		}
		
	    function removeLineItem(id){
		   $.post('/mr/dcr/delete-line-item/@dcr.id/'+id,function(htmldata){
		     $('#dcrLineItemTable').html(htmldata);
		    });
	     }
	</script>
	
}