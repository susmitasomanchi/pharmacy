@(dcr: models.mr.DailyCallReport, dcrLineItemForm:play.data.Form[models.mr.DCRLineItem],doctorList: List[models.doctor.Doctor],disabledDoctorList: List[models.doctor.Doctor],productList: List[Product])

@import play.i18n._
@import helper.twitterBootstrap._
@import helper._

@main("DCR Line Item"){
        
        <script src="@routes.Assets.at("javascripts/bootstrap-timepicker.min.js")" type="text/javascript"></script>
		<link href="/assets/css/bootstrap-timepicker.min.css" rel="stylesheet" type="text/css" />
	
	<style>
	.bootstrap-timepicker-widget table td input {
		width: 40px;
		}
	</style>
	<script>
	var proList = '<option></option>@for(product <-productList){<option value="@product.id">@product.medicineName</option>}';
	function removeSamples(id){
	$('#sample'+id).remove();
    }	
	
	var i=0;
	function addSamples(){
		$('#samplestbl').append('<tr id="sample'+i+'"><td><select id="selsam-'+i+'" class="chzn" style="width:200px;" name="sampleList">'+proList+'</select></td><td><input id="qty" class="qty-class numeric-textbox" name="qtyList" placeholder="quantity" /></td><td><a class="btn btn-danger btn-xs" onclick="removeSamples('+i+');">-</a></td></tr>');
	    $('#selsam-'+i).chosen();
	    i++;
	    numericValidation();
	    $('.qty-class').bind('copy paste cut',function(e) { 
	 					e.preventDefault(); //disable cut,copy,paste
	 				});
	}
	
	</script>
	<script type="text/javascript">
				
	
	
				$(document).ready(function() {

					numericValidation();
					
				 $('.input-small').bind('copy paste cut',function(e) { 
 					e.preventDefault(); //disable cut,copy,paste
 				});
				 $('#pob').bind('copy paste cut',function(e) { 
	 					e.preventDefault(); //disable cut,copy,paste
	 				});
				 $('#qty').bind('copy paste cut',function(e) { 
	 					e.preventDefault(); //disable cut,copy,paste
	 				});
				});
	</script>
	</script>
	
		
	<form id="dcrliform" name="dcrliform">
	<table border="1" style="width:1000px">
	<thead>
	   <th>Doctors</th>
	   <th>Samples</th>
	   <th>Promotions</th>
	   <th>In Time</th>
	   <th>Out Time</th>
	   <th>POB</th>
	   <th>Remarks</th>
	</thead>
	<tbody>
	<tr>
		
		<td valign="top" >
		<select id="selectDoctor" data-placeholder="Doctor" class="chzn" name="doctor" style="width:100px;" >
		   <option></option>
			@for(doctor <- doctorList){
				@if(disabledDoctorList.contains(doctor)){
					<option id="docid-@doctor.id" value="@doctor.id" disabled>@doctor.appUser.name</option>
				}else{
					<option id="docid-@doctor.id" value="@doctor.id" >@doctor.appUser.name</option>				
				}
	        }
	       </select>
	    </td>
	    
	    
		<td valign="top">
			<div id="samplesdiv">
			<table id="samplestbl">
				<tr>
					<td>
				  	   	<select id="select-samples" data-placeholder="Sample" class="chzn" name="sampleList" style="width:100px;" onchange="changeSample()">
				  	   	   <option></option>
							@for(product <- productList){
					      	<option value="@product.id">@product.medicineName</option>
					        }
			   		    </select>
					</td>
					<td>
						<input id="qty" class="qty-class numeric-textbox" name="qtyList" placeholder="quantity" style="width:100px"/>
					</td>
					<td>
						&nbsp;
					</td>
				</tr>
			</table>
			</div>   
			<button  type="button" class="btn btn-primary btn-xs" onclick="addSamples();">+</button>
	   	</td>
	   
	   
	   <td valign="top" >
			    <select id="promotionList" data-placeholder="Promotions" class="chzn" name="promotionList" multiple="true" style="width:100px;">
			    <option></option>
				@for(product <- productList){
				<option value=@product.id >@product.medicineName</option>
				}
				</select>
		</td>
		<td valign="top">
				<div class="input-append bootstrap-timepicker" style="width:200px">
	   			<input id="timepicker1" name="inTime" class="input-small">
	            <span class="add-on"><i class="fa fa-clock-o"></i></span>
	       		</div>
        </td>
		<td valign="top">
			<div class="input-append bootstrap-timepicker" style="width:200px">
	   			<input id="timepicker2" name="outTime" class="input-small">
	            <span class="add-on"><i class="fa fa-clock-o"></i></span>
	        </div>
        </td>
        
		<td valign="top"  ><input id="pob" class="numeric-textbox-pob" name="pob" style="width:145px"/></td>
		<td valign="top" ><input id="remarks" name="remarks" type="text" placeholder="Remarks" style="width:150px"/></td>
      </tr>
		
   </tbody>
	</table>
	
	<input type="hidden" name="dcrId" value="@dcr.id">

	</form>
	<br>
	<a class="btn btn-primary" onclick="addLineItem();">Add</a>
	
	<hr>
	
	
	<div id="dcrLineItemTable">

<table class="table table-bordered table-condensed">
	<thead>
	<tr>
	   <th>Doctors</th>
	   <th>Samples (Qty)</th>
	   <th>Promotions</th>
	   <th>InTime</th>
	   <th>OutTime</th>
	   <th>POB</th>
	   <th>Remarks</th>
	   <th>Actions</th>
	</tr>   
	</thead>
	<tbody>
	@for(dcrLineItem <- dcr.dcrLineItemList){
	<tr>
		<td>@dcrLineItem.doctor.appUser.name</td>
		<td>
			@for(sample <- dcrLineItem.sampleList){
				@if(sample.product != null){
				@sample.product.medicineName (@sample.quantity)
				<br>
				}
			}
	   	</td>
	   	<td valign="top">
			<div id="samplesdiv">
			      <table> 	
				  	@for(promotedProduct <- dcrLineItem.promotionList){
					  <tr>
						 <td>@promotedProduct.medicineName</td>
					  </tr>
					 }
			      </table>
			</div>   
	   	</td>
	   	
	   	@if(dcrLineItem.inTime == null){
	   		<td>&nbsp;</td>
	   		}else{
	   		<td>@dcrLineItem.inTime.format("kk:mm")</td>
	   		}
	   	@if(dcrLineItem.outTime == null){
	   		<td>&nbsp;</td>
	   		}else{
	   		<td>@dcrLineItem.outTime.format("kk:mm")</td>
	   		}
	   	
	    @if(dcrLineItem.pob==0){
	   		<td>&nbsp;</td>
	   	}else{
	   	<td>@dcrLineItem.pob</td>
	   	}
	   	
		<td>@dcrLineItem.remarks</td>
		<td><a class="btn btn-danger btn-md" onclick="removeLineItem('@dcrLineItem.id','@dcrLineItem.doctor.id');">Remove</a></td>
     </tr>
     }
   </tbody>
  </table>	
  
	</div>
	<script>
		$("#pob").keypress(function (evt) {
			  var keycode = evt.charCode || evt.keyCode;
			  if (keycode >=48 && keycode <=57) { //Enter key's keycode
			  }else{
			 return false;
			  }
			});

		function numericValidation(){
		$(".numeric-textbox").keypress(function (evt) {
			  var keycode = evt.charCode || evt.keyCode;
			  if (keycode >=48 && keycode <=57) {

				  if($("#select-samples").val() == "") {
					    alert("Please! Select a sample. ");
					    return false;
					   }
			  }else{
				 return false;
			  }
			});
		}

		
		function changeSample(){
			if($("#select-samples").val() == "") {
				document.dcrliform.qtyList.value = "";
			}else{
			if($("#qty").val() == "") {
				//alert("please Mention the quantity");
			}
			}
		}
		
	</script>
	<script type="text/javascript"> 
            $('.input-small').timepicker({
            	showMeridian:false,
            	defaultTime: false
                });
            $('#timepicker1').timepicker();
            $('#timepicker2').timepicker();
            $('#timepicker1').on('keydown',function(e)
        			{ 
        			        e.preventDefault();
        			});
        	$('#timepicker2').on('keydown',function(e)
        			{ 
        			        e.preventDefault();
        			});
    </script>
    
	<script>
		
	    function addLineItem(){
	    	var validFlag = true;
	    	var docId=$("#selectDoctor").val();
	    	if($('#selectDoctor').val()== ""){
	  		  alert('Please, Select a Doctor');
	   		  return false;
			}else{
				if($("#select-samples").val() == "") {
				document.dcrliform.qtyList.value = "";
				}else{
				
					$('.qty-class').each(function() {
						if($(this).val() == "") {
							alert("Please Mention Sample Quantity");
							validFlag = false;
							return false;
						}
					});
					
				}
				
				if(validFlag){
		        $.post('/mr/dcr/add-line-item',$('#dcrliform').serialize(),function(html){
					$('#dcrLineItemTable').html(html);
						$('#docid-'+docId).attr('disabled','disabled');
						$('#selectDoctor').val('').trigger("chosen:updated");
				});
				}
			}
			document.dcrliform.timepicker1.value = "";
			document.dcrliform.timepicker2.value = "";
			document.dcrliform.pob.value = "";
			document.dcrliform.remarks.value = "";
		}
		
	    function removeLineItem(id, docId){
		   $.post('/mr/dcr/delete-line-item/@dcr.id/'+id,function(htmldata){
		     $('#dcrLineItemTable').html(htmldata);
		     $('#docid-'+docId).removeAttr('disabled');
		     $('#selectDoctor').val('').trigger("chosen:updated");
		    });
	     }
	</script>
	
}